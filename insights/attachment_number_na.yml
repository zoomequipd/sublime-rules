name: "North American phone number in attachment"
type: "query"
source: | 
  type.inbound
  and any(attachments,
          any(file.explode(.),
              (
                any(.scan.strings.strings, strings.ilike(., "*+1*", "*+?1*"))
                or strings.ilike(.scan.ocr.raw, "*+1*", "*+?1*")
              )
              or (
                any(.scan.strings.strings, regex.icontains(., '\+?1\s[0-9]{3}\s([0-9]{7}|[0-9]{3}\s[0-9]{4})'))
                or regex.icontains(.scan.ocr.raw, '\+?1\s[0-9]{3}\s([0-9]{7}|[0-9]{3}\s[0-9]{4})')
              )
          )
  )
severity: "low"
